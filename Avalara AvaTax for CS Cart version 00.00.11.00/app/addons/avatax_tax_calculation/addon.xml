<?xml version="1.0"?>
<addon scheme="2.0" edition_type="ROOT,ULT:VENDOR">
	<id>avatax_tax_calculation</id>
	<version>1.1</version>
    <default_language>en</default_language>
	<name>Avalara AvaTax</name>
	<description>Avalara AvaTax</description>
	<priority>100502</priority>
	<status>active</status>
    <supplier>Avalara</supplier>
    <supplier_link>https://www.avalara.com</supplier_link>

    <settings edition_type="ROOT,ULT:VENDOR">
        <sections>
            <section id="section1">
                <name>Sign in</name>
                <items>
                    <item id="avatax_gen_info">
                        <type>info</type>
                        <handler>fn_avatax_tax_gen_info</handler>     
                    </item>   
                        <item id="avatax_account_number">
                        <type>input</type>
                        <tooltip>Account ID generated by AvaTax</tooltip>
                        <name>Account ID*</name>
                        <default_value/>
                    </item>
                    <item id="avatax_license_key">
                        <type>input</type>
                        <tooltip>License Key generated by AvaTax</tooltip>
                        <name>License Key*</name>
                        <default_value/>
                    </item>	
                    <item id="avatax_service_url">
                        <name>Service URL</name>
                        <type>selectbox</type>
                        <default_value>https://development.avalara.net/</default_value>
                        <variants>
                            <item id="https://development.avalara.net/">
                                <name>Sandbox</name>
                            </item>
                            <item id="https://avatax.avalara.net">
                                <name>Production</name>
                            </item>
                        </variants>
                    </item>
                    <item id="avatax_test_connection">
                            <name>AvaTax Service</name>
                            <type>info</type>
                            <handler>fn_avatax_tax_calculation_testconnection</handler>
                    </item>
                        <item id="select_codes">
                            <name>Company Name*</name>
                        <type>selectbox</type>
                        <default_value/>
                    </item>
                    <item id="avatax_company_code">
                        <name>Company Code*</name>
                        <type>input</type>
                        <default_value/>
                    </item>
                    <item id="avatax_tax_calculation">
                        <name>Enable AvaTax tax calculation</name>
                        <type>radiogroup</type>
                        <default_value>1</default_value>
                        <variants>
                            <item id="1">
                                <name>Yes</name>
                            </item>
                            <item id="0">
                                <name>No</name>
                            </item>
                            </variants>
                    </item>
                    <item id="avatax_tax_upc">
                        <name>Send UPC code to AvaTax</name>
                        <type>radiogroup</type>
                        <tooltip>If UPC is not available then Model Number will be sent to AvaTax by default</tooltip>
                        <default_value>0</default_value>
                        <variants>
                            <item id="1">
                                <name>Yes</name>
                            </item>
                            <item id="0">
                                <name>No</name>
                            </item>
                        </variants>
                    </item>
                    <item id="avatax_tax_savedoc">
                        <name>Save Transaction to AvaTax</name>
                        <type>radiogroup</type>
                        <default_value>0</default_value>
                        <variants>
                            <item id="1">
                                <name>Yes</name>
                            </item>
                            <item id="0">
                                <name>No</name>
                            </item>
                        </variants>
                    </item>
                    <item id="avatax_tax_address_validation" name="avatax_tax_address_validation">
                        <name>Enable AvaTax address validation</name>
                        <type>radiogroup</type>
                        <default_value>0</default_value>
                        <variants>
                            <item id="1">
                                <name>Yes</name>
                            </item>
                            <item id="0">
                                <name>No</name>
                            </item>
                            </variants>
                    </item>
                    <item id="avatax_log_mode">
                        <name>Enable Log</name>
                        <type>radiogroup</type>
                        <default_value>0</default_value>
                        <variants>
                            <item id="1">
                                <name>Yes</name>
                            </item>
                            <item id="0">
                                <name>No</name>
                            </item>
                        </variants>
                    </item>
                    <item id="avatax_admin_console_link">
                            <name>AvaTax Dashboard link</name>
                            <type>info</type>
                            <handler>fn_avatax_tax_calculation_admin_console_link</handler>
                    </item>
                    <item id="avatax_admin_TPA_link">
                            <name>AvaTax Tax Profile Assistant Link</name>
                            <type>info</type>
                            <handler>fn_avatax_tax_calculation_TPA_link</handler>
                    </item>
                </items>
            </section>
        </sections>
    </settings>

	<queries>

        <!-- Install-->

		<item for="install">ALTER TABLE `?:status_descriptions` ADD status VARCHAR(1) NOT NULL;</item>
		<item for="install">ALTER TABLE `?:status_descriptions` ADD type VARCHAR(1) NOT NULL;</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'A' , type = 'G' where description ='Active';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'A' , type = 'R' where description ='Approved';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'Y' , type = 'O' where description ='Awaiting Call';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'B' , type = 'O' where description ='Backordered';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'I' , type = 'O' where description ='Canceled';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'C' , type = 'O' where description ='Complete';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'C' , type = 'R' where description ='Completed';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'C' , type = 'G' where description ='Disabled';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'F' , type = 'O' where description ='Failed';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'O' , type = 'O' where description ='Open';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'P' , type = 'G' where description ='Pending';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'P' , type = 'O' where description ='Processed';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'R' , type = 'R' where description ='Requested';</item>
		<item for="install">UPDATE `?:status_descriptions` SET status = 'U' , type = 'G' where description ='Used';</item>
		<item for="install">ALTER TABLE `?:orders` ADD `avatax_paytax_document_id` INT NOT NULL DEFAULT '0', ADD `avatax_paytax_transaction_id` INT NOT NULL DEFAULT '0', ADD `avatax_paytax_document_code` VARCHAR( 40 ) NOT NULL, ADD `avatax_paytax_error_message` TEXT NOT NULL;</item>
		<item for="install">ALTER TABLE `?:status_descriptions` ADD `avatax_document_status` VARCHAR( 30 ) NOT NULL;</item>
		<item for="install">UPDATE `?:status_descriptions` SET avatax_document_status = 'Committed' where status ='C' and type = 'O';</item>
		<item for="install">UPDATE `?:status_descriptions` SET avatax_document_status = 'Committed' where status ='P' and type = 'O';</item>
		<item for="install">UPDATE `?:status_descriptions` SET avatax_document_status = 'Uncommitted' where status ='O' and type = 'O';</item>
		<item for="install">UPDATE `?:status_descriptions` SET avatax_document_status = 'Voided' where status ='F' and type = 'O';</item>
		<item for="install">UPDATE `?:status_descriptions` SET avatax_document_status = 'Voided' where status ='D' and type = 'O';</item>
		<item for="install">UPDATE `?:status_descriptions` SET avatax_document_status = 'Uncommitted' where status ='B' and type = 'O';</item>
		<item for="install">UPDATE `?:status_descriptions` SET avatax_document_status = 'Voided' where status ='I' and type = 'O';</item>
        <item for="install">UPDATE `?:status_descriptions` SET avatax_document_status = 'Uncommitted' where status ='R' and type = 'R';</item>
        <item for="install">UPDATE `?:status_descriptions` SET avatax_document_status = 'Committed' where status ='A' and type = 'R';</item>
        <item for="install">UPDATE `?:status_descriptions` SET avatax_document_status = 'Voided' where status ='D' and type = 'R';</item>
        <item for="install">UPDATE `?:status_descriptions` SET avatax_document_status = 'Committed' where status ='C' and type = 'R';</item>
		<item for="install">ALTER TABLE ?:rma_returns ADD `avatax_return_document_code` VARCHAR( 10 ) NOT NULL;</item>
		<item for="install">ALTER TABLE ?:users ADD `tax_exempt_number` VARCHAR( 30 ) NOT NULL;</item>		
		<item for="install">ALTER TABLE ?:users ADD `tax_entity_usecode` CHAR( 1 ) NOT NULL;</item>		
		<item for="install">DROP TABLE IF EXISTS ?:avatax_entity_usecode;</item>
		<item for="install">
			CREATE TABLE `?:avatax_entity_usecode` (  
				`usecode` CHAR(1) NOT NULL,  
				`description` VARCHAR( 250 ) NOT NULL 
			) Engine=MyISAM DEFAULT CHARSET UTF8;
		</item>
		<item for="install">
		    INSERT INTO `?:avatax_entity_usecode` (`usecode`, `description`) VALUES ("-", "Select Entity Use Code"),("A", "Federal government (United States)"), ("B", "State government (United States)"), ("C", "Tribe / Status Indian / Indian Band (both)"), ("D", "Foreign diplomat (both)"), ("E", "Charitable or benevolent org (both)"), ("F", "Religious or educational org (both)"), ("G", "Resale (both)"), ("H", "Commercial agricultural production (both)"), ("I", "Industrial production / manufacturer (both)"), ("J", "Direct pay permit (United States)"), ("K", "Direct mail (United States)"), ("L", "Other (both)"), ("N", "Local government (United States)"), ("P", "Commercial aquaculture (Canada)"), ("Q", "Commercial Fishery (Canada)"), ("R", "Non-resident (Canada)");
		</item>
		<item for="install">ALTER TABLE ?:products ADD `tax_code` VARCHAR( 11 ) DEFAULT 'none';</item>
		<item for="install">UPDATE ?:products SET `tax_code`= 'none' WHERE `tax_code` = 'none';</item>

        <item for="install">ALTER TABLE ?:products ADD `upc_code` VARCHAR( 20 ) DEFAULT 'none';</item>
        <item for="install">UPDATE ?:products SET `upc_code`= 'none' WHERE `upc_code` = 'none';</item>

		<item for="install">ALTER TABLE ?:shippings ADD `tax_code` VARCHAR( 11 ) DEFAULT 'none';</item>
		<item for="install">UPDATE ?:shippings SET `tax_code`= 'none' WHERE `tax_code` = 'none';</item>

        <item for="install">ALTER TABLE ?:users ADD `tax_exempt_number` VARCHAR( 25 ) NOT NULL DEFAULT 'Tax Exempt';</item>
        <item for="install">UPDATE ?:users SET `tax_exempt_number`= 'none' WHERE `tax_exempt_number` = 'Tax Exempt';</item>

        <!-- Uninstall -->
        
		<item for="uninstall">ALTER TABLE `?:status_descriptions` DROP COLUMN status;</item>
		<item for="uninstall">ALTER TABLE `?:status_descriptions` DROP COLUMN type;</item>

        <item for="uninstall">ALTER TABLE `?:orders` DROP COLUMN `avatax_paytax_document_id`;</item>
        <item for="uninstall">ALTER TABLE `?:orders` DROP COLUMN `avatax_paytax_transaction_id`;</item>
        <item for="uninstall">ALTER TABLE `?:orders` DROP COLUMN `avatax_paytax_document_code`;</item>
        <item for="uninstall">ALTER TABLE `?:orders` DROP COLUMN `avatax_paytax_error_message`;</item>

		<item for="uninstall">ALTER TABLE `?:status_descriptions` DROP COLUMN `avatax_document_status`;</item>

        <item for="uninstall">ALTER TABLE ?:rma_returns DROP COLUMN `avatax_return_document_code`;</item>
		<item for="uninstall">ALTER TABLE ?:users DROP COLUMN `tax_exempt_number`;</item>		
		<item for="uninstall">ALTER TABLE ?:users DROP COLUMN `tax_entity_usecode`;</item>	

        <item for="uninstall">DROP TABLE IF EXISTS ?:avatax_entity_usecode;</item>

        <item for="uninstall">ALTER TABLE ?:products DROP COLUMN `tax_code`;</item>
        <item for="uninstall">ALTER TABLE ?:products DROP COLUMN `upc_code`;</item>
        <item for="uninstall">ALTER TABLE ?:shippings DROP COLUMN `tax_code`;</item>
	</queries>
</addon>